---
layout:     post
title:      "Flink 状态总结"
subtitle:   "近期，有关Flink状态的问题，读者咨询较多，我做一次总结"
date:       2019-5-13
author:     "松鼠学苑 余海峰"
cover: "/assets/img/flinkbook.jpg"
categories: technology
tags: flink
---

**1.什么是state**

简单地理解是某个记数值、如1小时内订单数，但实际上远比这复杂.
Flink框架底层用Java实现的(某章的思考问题的hint)，Java是面向对象的语言，因此状态不是简单的数字，而是有结构的;
窗口是流处理核心概念之一，窗口状态的内容更丰富了，事件记录本身、算子处理函数、中间结果(累加模式)，甚于事件时间/处理时间的推进情况，这都是状态的内容，尤其是后者，不太好理解，参阅《深入理解Flink:实时大数据处理实践》。

**2.为什么需要状态后端**

是因为容错需要，系统挂掉了，怎么从上一个正确的处理点恢复系统呢，把状态记录下来，就是最直白的方案，详参阅书，ABS章节。
引入rocksdb作为状态后端的目的是做增量式快照，以减小快照体积，据说阿里的是TB，这是很可怕的体积，因为他和内存挂勾的。
系统都做快照了，状态不就保存下来了么。此外，这个快照也可以用于版本升级。

**3.银行存在几个世纪了，但Flink最近才进入他们的视野，现在的Flink应用程序怎么初始化呢?**

首先，我们必须选择一个基准时间点，使用Kafka时空穿梭能力将DataStream倒回某个点，开启我们的程序;
其次，如果窗口较大且业务结果和业务的第一条数据都有关(几个世纪前的数据)，那么你需要加载陈年数据走一遍Flink应用程。
注意这里的初始化和2中的区别。

**4.Flink的Sink有多种形式，典型的是将输出发射到DownStream，由其负责测量监控展示、持久化。**
